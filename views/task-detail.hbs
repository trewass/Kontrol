<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞–¥–∞—á–∞ {{task.title}}</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; }
    .back { display: inline-block; margin-bottom: 20px; color: #007bff; text-decoration: none; }
    .back:hover { text-decoration: underline; }
    .card { background: white; padding: 30px; border-radius: 8px; margin-bottom: 20px; }
    h1 { margin-bottom: 20px; color: #333; }
    .field { margin-bottom: 15px; }
    .field-label { font-weight: 600; color: #666; margin-bottom: 5px; }
    .field-value { color: #333; line-height: 1.6; }
    .events { margin-top: 30px; }
    .event { padding: 15px; background: #f8f9fa; border-left: 3px solid #007bff; margin-bottom: 10px; border-radius: 4px; }
    .event-header { font-weight: 600; margin-bottom: 5px; }
    .event-time { color: #666; font-size: 14px; }
    .tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .tag { background: #e9ecef; padding: 4px 10px; border-radius: 4px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <a href="/admin" class="back">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>

    {{#if error}}
      <div class="card">
        <h1>–û—à–∏–±–∫–∞</h1>
        <p>{{error}}</p>
      </div>
    {{else}}
      <div class="card">
        <h1>{{task.title}}</h1>

        <div class="field">
          <div class="field-label">–°—Ç–∞—Ç—É—Å</div>
          <div class="field-value">
            {{#if (eq task.status "NEW")}}üÜï –ù–æ–≤–∞—è{{/if}}
            {{#if (eq task.status "IN_PROGRESS")}}üîµ –í —Ä–∞–±–æ—Ç–µ{{/if}}
            {{#if (eq task.status "CLARIFICATION")}}üü° –£—Ç–æ—á–Ω—è–µ—Ç—Å—è{{/if}}
            {{#if (eq task.status "POSTPONED")}}üü† –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ{{/if}}
            {{#if (eq task.status "DONE")}}‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ{{/if}}
            {{#if (eq task.status "REJECTED")}}üß® –û—Ç–∫–ª–æ–Ω–µ–Ω–æ{{/if}}
          </div>
        </div>

        {{#if task.description}}
        <div class="field">
          <div class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
          <div class="field-value">{{task.description}}</div>
        </div>
        {{/if}}

        {{#if task.clientName}}
        <div class="field">
          <div class="field-label">–ö–ª–∏–µ–Ω—Ç</div>
          <div class="field-value">{{task.clientName}}</div>
        </div>
        {{/if}}

        {{#if task.objectName}}
        <div class="field">
          <div class="field-label">–û–±—ä–µ–∫—Ç</div>
          <div class="field-value">{{task.objectName}}</div>
        </div>
        {{/if}}

        {{#if task.assignee}}
        <div class="field">
          <div class="field-label">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</div>
          <div class="field-value">{{task.assignee.name}}</div>
        </div>
        {{/if}}

        {{#if task.dueText}}
        <div class="field">
          <div class="field-label">–°—Ä–æ–∫</div>
          <div class="field-value">{{task.dueText}}</div>
        </div>
        {{/if}}

        <div class="field">
          <div class="field-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
          <div class="field-value">
            {{#if (eq task.priority "HIGH")}}üî• –í—ã—Å–æ–∫–∏–π{{/if}}
            {{#if (eq task.priority "NORMAL")}}‚û°Ô∏è –û–±—ã—á–Ω—ã–π{{/if}}
            {{#if (eq task.priority "LOW")}}‚¨áÔ∏è –ù–∏–∑–∫–∏–π{{/if}}
          </div>
        </div>

        {{#if task.tags.length}}
        <div class="field">
          <div class="field-label">–¢–µ–≥–∏</div>
          <div class="tags">
            {{#each task.tags}}
            <span class="tag">{{this}}</span>
            {{/each}}
          </div>
        </div>
        {{/if}}

        <div class="field">
          <div class="field-label">–ò—Å—Ç–æ—á–Ω–∏–∫</div>
          <div class="field-value">{{task.source.type}} ({{task.source.name}})</div>
        </div>

        <div class="field">
          <div class="field-label">–°–æ–∑–¥–∞–Ω–æ</div>
          <div class="field-value">{{formatDate task.createdAt}}</div>
        </div>
      </div>

      {{#if task.events.length}}
      <div class="card events">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</h2>
        {{#each task.events}}
        <div class="event">
          <div class="event-header">
            {{#if (eq this.type "CREATED")}}‚ú® –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞{{/if}}
            {{#if (eq this.type "STATUS_CHANGED")}}üîÑ –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω—ë–Ω: {{this.oldStatus}} ‚Üí {{this.newStatus}}{{/if}}
            {{#if (eq this.type "ASSIGNED")}}üë§ –ù–∞–∑–Ω–∞—á–µ–Ω –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å{{/if}}
            {{#if (eq this.type "REMINDED")}}‚è∞ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ{{/if}}
          </div>
          <div class="event-time">
            {{formatDate this.createdAt}}
            {{#if this.user}}‚Äî {{this.user.name}}{{/if}}
          </div>
        </div>
        {{/each}}
      </div>
      {{/if}}
    {{/if}}
  </div>
</body>
</html>
