# –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π Kontrol

## [1.1.0] - 2025-01-XX - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### üé§ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤:** –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã, –≤–∏–¥–µ–æ –∫—Ä—É–∂–∫–∏ (video notes)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ:** Whisper API (OpenAI) —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–¥–∞—á:** —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### LlmService ([src/llm/llm.service.ts](src/llm/llm.service.ts))
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `transcribeAudio(audioBuffer: Buffer): Promise<string | null>`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Whisper-1 –º–æ–¥–µ–ª—å –æ—Ç OpenAI
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞: —Ä—É—Å—Å–∫–∏–π (language: 'ru')
- –§–æ—Ä–º–∞—Ç: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Buffer ‚Üí File (audio/ogg)

#### TelegramService ([src/telegram/telegram.service.ts](src/telegram/telegram.service.ts))
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
  - `message:voice` ‚Äî –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `message:audio` ‚Äî –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã
  - `message:video_note` ‚Äî –≤–∏–¥–µ–æ –∫—Ä—É–∂–∫–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `handleAudioMessage(ctx, fileId, type)`:
  1. –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ —á–µ—Ä–µ–∑ `bot.api.getFile()`
  2. –°–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Telegram File API
  3. –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ LlmService
  4. –î–æ–±–∞–≤–ª—è–µ—Ç –≤ BullMQ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `downloadFile(url): Promise<Buffer>`

#### TelegramModule ([src/telegram/telegram.module.ts](src/telegram/telegram.module.ts))
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `LlmModule` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

#### README.md
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—É–Ω–∫—Ç "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π" –≤ —Ñ—É–Ω–∫—Ü–∏–∏ MVP
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω —Ä–∞–∑–¥–µ–ª –°—Ç–µ–∫: —É–∫–∞–∑–∞–Ω Whisper-1 –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ü—Ä–∏–º–µ—Ä 3: –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### STRUCTURE.md
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ `llm.service.ts`: GPT-4o-mini + Whisper-1
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ `telegram.service.ts`: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö "2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"

#### examples/test-scenarios.md
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è)
- –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤–∞–Ω—ã –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (6-9)

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–î–æ:**
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç: "–ù–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–≤–æ–¥—á–∏–∫–∏ –Ω–∞ –∫—É—Ö–Ω—é —É –°–∏–¥–æ—Ä–æ–≤—ã—Ö"
```

**–ü–æ—Å–ª–µ:**
```
üé§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∏–∫—Ç—É–µ—Ç: "–ù–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–≤–æ–¥—á–∏–∫–∏ –Ω–∞ –∫—É—Ö–Ω—é —É –°–∏–¥–æ—Ä–æ–≤—ã—Ö"
   ‚Üì
Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç ‚Üí —Ç–µ–∫—Å—Ç
   ‚Üì
LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–¥–∞—á—É ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –¢–∏–ø | Telegram API | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|-------------|------------|----------|
| üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ | `message:voice` | `handleAudioMessage()` | .ogg —Ñ–∞–π–ª—ã (opus codec) |
| üéµ –ê—É–¥–∏–æ | `message:audio` | `handleAudioMessage()` | .mp3, .m4a –∏ –¥—Ä—É–≥–∏–µ |
| üî¥ –í–∏–¥–µ–æ –∫—Ä—É–∂–æ–∫ | `message:video_note` | `handleAudioMessage()` | –ö—Ä—É–≥–ª—ã–µ –≤–∏–¥–µ–æ —Å –∞—É–¥–∏–æ |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **OpenAI API Key** —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Whisper API
   ```env
   LLM_API_KEY="sk-..."
   LLM_BASE_URL="https://api.openai.com/v1"
   ```

2. **–ü—Ä–∞–≤–∞ Telegram –±–æ—Ç–∞** –Ω–∞ —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (Privacy Mode = Disabled)

### –°—Ç–æ–∏–º–æ—Å—Ç—å

Whisper API:
- $0.006 –∑–∞ –º–∏–Ω—É—Ç—É –∞—É–¥–∏–æ
- –°—Ä–µ–¥–Ω—è—è –≥–æ–ª–æ—Å–æ–≤–∞—è –∑–∞–¥–∞—á–∞: 10-30 —Å–µ–∫—É–Ω–¥ = $0.001-0.003
- 1000 –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–∞–¥–∞—á ‚âà $1-3

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 20 MB (–ª–∏–º–∏—Ç Telegram Bot API)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: `.ogg`, `.mp3`, `.m4a`, `.wav`, `.webm`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Whisper API (–æ–±—ã—á–Ω–æ –¥–æ 25 MB —Ñ–∞–π–ª–∞)

---

## [1.0.0] - 2025-01-XX - –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑

### –§—É–Ω–∫—Ü–∏–∏ MVP
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ Telegram –≥—Ä—É–ø–ø –∏ WhatsApp (Wazzup)
- ‚úÖ LLM-–∞–Ω–∞–ª–∏–∑ —Å production –ø—Ä–æ–º–ø—Ç–æ–º (—Å–ª–æ–≤–∞—Ä—å –º–µ–±–µ–ª–∏)
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–¥–∞—á
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–Ω–µ –≤–∑—è–ª–∏, –¥–µ–¥–ª–∞–π–Ω—ã)
- ‚úÖ –í–µ–±-–∞–¥–º–∏–Ω
- ‚úÖ Docker-compose

### –°—Ç–µ–∫
- Node.js 20 + NestJS + TypeScript
- PostgreSQL 16 + Prisma
- BullMQ + Redis
- Grammy (Telegram Bot API)
- OpenAI API (GPT-4o-mini)
- Express Handlebars

---

**–°–ª–µ–¥—É—é—â–∏–µ –≤–µ—Ä—Å–∏–∏:**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö)
- [ ] –ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã (TTS –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º amoCRM API
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤
