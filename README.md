# Kontrol ‚Äî MVP –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –∑–∞–¥–∞—á –¥–ª—è –º–µ–±–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞

> –°–æ–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ Telegram –≥—Ä—É–ø–ø –∏ WhatsApp (—á–µ—Ä–µ–∑ Wazzup), –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏—Ö —Å –ø–æ–º–æ—â—å—é LLM –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞–º–∏.

---

## –§—É–Ω–∫—Ü–∏–∏ MVP

- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –∏–∑ Telegram –≥—Ä—É–ø–ø –∏ WhatsApp (Wazzup webhooks)
- ‚úÖ **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π** (Whisper API) ‚Äî –≥–æ–ª–æ—Å–æ–≤—ã–µ, –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ –∫—Ä—É–∂–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è
- ‚úÖ LLM-–∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π —Å production –ø—Ä–æ–º–ø—Ç–æ–º (—Å–ª–æ–≤–∞—Ä—å –º–µ–±–µ–ª–∏: —Ç–∏–ø–æ–Ω, –î–°–ü, —Ñ–∞—Å–∞–¥—ã, –∑–∞–º–µ—Ä, –º–æ–Ω—Ç–∞–∂)
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–¥–∞—á (–æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ = –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞)
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç –∑–∞–¥–∞—á —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏ (–í–∑—è–ª / –£—Ç–æ—á–Ω–∏—Ç—å / –ü–µ—Ä–µ–Ω—ë—Å / –ó–∞–∫—Ä—ã–ª / –ù–µ –∑–∞–¥–∞—á–∞)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–æ–∫
- ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: –Ω–µ –≤–∑—è–ª–∏ –∑–∞ N –º–∏–Ω—É—Ç, –∑–∞ 24 —á–∞—Å–∞ –∏ 2 —á–∞—Å–∞ –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –≤–µ–±-–∞–¥–º–∏–Ω: —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á, —Ñ–∏–ª—å—Ç—Ä—ã, –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ Docker-compose –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## –°—Ç–µ–∫

- **Backend:** Node.js 20 + NestJS + TypeScript
- **Database:** PostgreSQL 16 + Prisma ORM
- **Queue:** BullMQ + Redis
- **Bot:** Grammy (Telegram Bot API)
- **LLM:** OpenAI-compatible API (GPT-4o-mini –¥–ª—è –∑–∞–¥–∞—á, Whisper-1 –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏)
- **Views:** Express Handlebars

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Kontrol/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ admin/          # –í–µ–±-–∞–¥–º–∏–Ω (—Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á, –∏—Å—Ç–æ—Ä–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ common/         # JSON Schema –¥–ª—è LLM –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ database/       # Prisma Service
‚îÇ   ‚îú‚îÄ‚îÄ llm/            # LLM —Å–µ—Ä–≤–∏—Å —Å production –ø—Ä–æ–º–ø—Ç–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ queue/          # BullMQ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/      # Cron –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ tasks/          # TasksService (CRUD –∑–∞–¥–∞—á)
‚îÇ   ‚îú‚îÄ‚îÄ telegram/       # Telegram –±–æ—Ç (webhook, callbacks)
‚îÇ   ‚îú‚îÄ‚îÄ wazzup/         # Wazzup webhook endpoint
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts
‚îÇ   ‚îî‚îÄ‚îÄ main.ts
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma   # –ë–î —Å—Ö–µ–º–∞ (tasks, task_events, sources, users)
‚îú‚îÄ‚îÄ views/              # Handlebars —à–∞–±–ª–æ–Ω—ã –¥–ª—è –≤–µ–±-–∞–¥–º–∏–Ω–∞
‚îú‚îÄ‚îÄ examples/           # –ü—Ä–∏–º–µ—Ä—ã Wazzup webhook payload
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ README.md
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
cd /Users/xxx/Projects/Kontrol
```

### 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# Database (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è docker-compose)
DATABASE_URL="postgresql://kontrol:kontrol@localhost:5432/kontrol?schema=public"

# Telegram Bot
TELEGRAM_BOT_TOKEN="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11"
TELEGRAM_TASKS_CHAT_ID="-1001234567890"

# LLM API
LLM_API_KEY="sk-..."
LLM_BASE_URL="https://api.openai.com/v1"
LLM_MODEL="gpt-4o-mini"

# Redis (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è docker-compose)
REDIS_HOST="localhost"
REDIS_PORT=6379

# –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
REMIND_NEW_MINUTES=30
REMIND_DUE_24H=true
REMIND_DUE_2H=true

# Server
PORT=3000
NODE_ENV=development
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
docker-compose up -d
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- PostgreSQL –Ω–∞ –ø–æ—Ä—Ç—É 5432
- Redis –Ω–∞ –ø–æ—Ä—Ç—É 6379
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç—É 3000

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
docker-compose logs -f app
```

### 5. –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∞–¥–º–∏–Ω

```
http://localhost:3000/admin
```

---

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20+
- PostgreSQL 16+
- Redis 7+

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env

```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ DATABASE_URL, REDIS_HOST –∏ –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
npx prisma migrate dev
npx prisma generate
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å dev-—Å–µ—Ä–≤–µ—Ä

```bash
npm run start:dev
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞

1. –û—Ç–∫—Ä—ã—Ç—å [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/newbot`
3. –£–∫–∞–∑–∞—Ç—å –∏–º—è: `Kontrol Bot`
4. –£–∫–∞–∑–∞—Ç—å username: `kontrol_tasks_bot`
5. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω ‚Üí –≤ `.env` –∫–∞–∫ `TELEGRAM_BOT_TOKEN`

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å "–ì–ª–∞–≤–Ω—ã–π —á–∞—Ç –∑–∞–¥–∞—á"

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É –≤ Telegram: `–ó–ê–î–ê–ß–ò`
2. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –ü–æ–ª—É—á–∏—Ç—å chat_id:
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
   - –û—Ç–∫—Ä—ã—Ç—å `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
   - –ù–∞–π—Ç–∏ `"chat":{"id":-1001234567890,...}`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID ‚Üí –≤ `.env` –∫–∞–∫ `TELEGRAM_TASKS_CHAT_ID`

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –±–æ—Ç–∞

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!** –ë–æ—Ç –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö.

1. –û—Ç–∫—Ä—ã—Ç—å [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/setprivacy`
3. –í—ã–±—Ä–∞—Ç—å –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –í—ã–±—Ä–∞—Ç—å `Disable` (–±–æ—Ç –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ —Ä–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã

1. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—ã, –≥–¥–µ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú–µ–Ω–µ–¥–∂–µ—Ä—ã", "–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫–∏")
2. –°–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [ngrok](https://ngrok.com/) –∏–ª–∏ [Cloudflare Tunnel](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/).

#### –° ngrok:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ngrok
brew install ngrok  # macOS
# –∏–ª–∏ —Å–∫–∞—á–∞—Ç—å —Å https://ngrok.com/download

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://abc123.ngrok.io`) –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook:

```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://abc123.ngrok.io/telegram/webhook"
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook:

```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Wazzup (WhatsApp —á–µ—Ä–µ–∑ amoCRM)

### –ò–º–∏—Ç–∞—Ü–∏—è webhook (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)

–í –ø–∞–ø–∫–µ `examples/` –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ payload –¥–ª—è Wazzup:

```bash
# –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
curl -X POST http://localhost:3000/wazzup/webhook \
  -H "Content-Type: application/json" \
  -d @examples/wazzup-webhook-incoming.json

# –ü—Ä–∏–º–µ—Ä —Å–ª–æ–∂–Ω–æ–π –∑–∞–¥–∞—á–∏
curl -X POST http://localhost:3000/wazzup/webhook \
  -H "Content-Type: application/json" \
  -d @examples/wazzup-webhook-complex.json
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Wazzup

1. –í–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç [Wazzup](https://wazzup24.com/)
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í–µ–±—Ö—É–∫–∏**
3. –î–æ–±–∞–≤–∏—Ç—å webhook URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/wazzup/webhook`
4. –í—ã–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è: `message.incoming`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ó–∞–¥–∞—á–∞ —Å –¥–µ–¥–ª–∞–π–Ω–æ–º

**–°–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ Telegram:**
```
–ü–µ—Ç—è, —Å–æ–∑–≤–æ–Ω–∏—Å—å —Å –ò–≤–∞–Ω–æ–≤—ã–º –¥–æ –ø—è—Ç–Ω–∏—Ü—ã, –æ–Ω —Ö–æ—á–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç —Ñ–∞—Å–∞–¥–æ–≤ –Ω–∞ –≤–µ–Ω–≥–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç: `{ is_task: true, assignee: "–ü–µ—Ç—è", title: "–°–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è —Å –ò–≤–∞–Ω–æ–≤—ã–º –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ü–≤–µ—Ç–∞ —Ñ–∞—Å–∞–¥–æ–≤", client_name: "–ò–≤–∞–Ω–æ–≤", tags: ["—Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è", "—Ñ–∞—Å–∞–¥—ã", "—Ü–≤–µ—Ç"], priority: "normal", due_text: "–¥–æ –ø—è—Ç–Ω–∏—Ü—ã" }`
- –ó–∞–¥–∞—á–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏
- –ü–µ—Ç—è –Ω–∞–∂–∏–º–∞–µ—Ç "‚úÖ –í–∑—è–ª" ‚Üí —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ IN_PROGRESS
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 24 —á–∞—Å–∞ –¥–æ –ø—è—Ç–Ω–∏—Ü—ã

### –ü—Ä–∏–º–µ—Ä 2: –°—Ä–æ—á–Ω–∞—è –∑–∞–¥–∞—á–∞ –±–µ–∑ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

**–°–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp (—á–µ—Ä–µ–∑ Wazzup):**
```
–°–†–û–ß–ù–û! –ó–∞–º–µ—Ä –Ω–∞ —É–ª. –õ–µ–Ω–∏–Ω–∞ 5 –∑–∞–≤—Ç—Ä–∞ –∫ 10:00
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç: `{ is_task: true, assignee: null, title: "–ó–∞–º–µ—Ä –Ω–∞ —É–ª. –õ–µ–Ω–∏–Ω–∞ 5", priority: "high", object_name: "—É–ª. –õ–µ–Ω–∏–Ω–∞ 5", tags: ["–∑–∞–º–µ—Ä", "—Å—Ä–æ—á–Ω–æ"], due_text: "–∑–∞–≤—Ç—Ä–∞ –∫ 10:00" }`
- –ó–∞–¥–∞—á–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç
- –õ—é–±–æ–π –º–æ–Ω—Ç–∞–∂–Ω–∏–∫ –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "‚úÖ –í–∑—è–ª"
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç, –µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –≤–∑—è–ª

### –ü—Ä–∏–º–µ—Ä 3: –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram:**
```
üé§ "–ù–∞–¥–æ —Å—Ä–æ—á–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –¥–æ–≤–æ–¥—á–∏–∫ –Ω–∞ –∫—É—Ö–æ–Ω–Ω–æ–º —à–∫–∞—Ñ—É —É –ü–µ—Ç—Ä–æ–≤—ã—Ö, –∞–¥—Ä–µ—Å –°–∞–¥–æ–≤–∞—è 12"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç: "–ù–∞–¥–æ —Å—Ä–æ—á–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –¥–æ–≤–æ–¥—á–∏–∫ –Ω–∞ –∫—É—Ö–æ–Ω–Ω–æ–º —à–∫–∞—Ñ—É —É –ü–µ—Ç—Ä–æ–≤—ã—Ö, –∞–¥—Ä–µ—Å –°–∞–¥–æ–≤–∞—è 12"
- LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç: `{ is_task: true, title: "–ü–æ–º–µ–Ω—è—Ç—å –¥–æ–≤–æ–¥—á–∏–∫ –Ω–∞ –∫—É—Ö–æ–Ω–Ω–æ–º —à–∫–∞—Ñ—É", client_name: "–ü–µ—Ç—Ä–æ–≤—ã", object_name: "–°–∞–¥–æ–≤–∞—è 12", tags: ["–¥–æ–≤–æ–¥—á–∏–∫", "–∫—É—Ö–Ω—è"], priority: "high" }`
- –ó–∞–¥–∞—á–∞ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω—ã–π —á–∞—Ç

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:**
- üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- üéµ –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã
- üî¥ –í–∏–¥–µ–æ –∫—Ä—É–∂–∫–∏ (–∫—Ä—É–≥–ª—ã–µ –≤–∏–¥–µ–æ)

### –ü—Ä–∏–º–µ—Ä 4: –ù–µ –∑–∞–¥–∞—á–∞ (—Ñ–ª—É–¥)

**–°–æ–æ–±—â–µ–Ω–∏–µ:**
```
–ö–∞–∫ –¥—É–º–∞–µ—à—å, –∫–∞–∫–æ–π —Ü–≤–µ—Ç –ª—É—á—à–µ?
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ is_task: false, confidence: 0.1 }`
- –ó–∞–¥–∞—á–∞ –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è

---

## API endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/telegram/webhook` | POST | Telegram bot webhook |
| `/wazzup/webhook` | POST | Wazzup webhook (WhatsApp) |
| `/admin` | GET | –í–µ–±-–∞–¥–º–∏–Ω: —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á |
| `/admin/task/:id` | GET | –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ + –∏—Å—Ç–æ—Ä–∏—è |

---

## –°—Ö–µ–º–∞ –ë–î

### tasks

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | String (cuid) | Primary key |
| status | Enum | NEW / IN_PROGRESS / CLARIFICATION / POSTPONED / DONE / REJECTED |
| priority | Enum | LOW / NORMAL / HIGH |
| title | String | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| description | String? | –î–µ—Ç–∞–ª–∏ |
| clientName | String? | –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ |
| objectName | String? | –ê–¥—Ä–µ—Å/–æ–±—ä–µ–∫—Ç |
| tags | String[] | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ |
| dueText | String? | –°—Ä–æ–∫ (—Ç–µ–∫—Å—Ç) |
| dueAt | DateTime? | –°—Ä–æ–∫ (ISO) |
| assigneeId | String? | FK ‚Üí users.id |
| sourceId | String | FK ‚Üí sources.id |
| sourceMessageId | String | ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ |
| tasksMessageId | String? | ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥–ª–∞–≤–Ω–æ–º —á–∞—Ç–µ |
| confidence | Float | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å LLM (0-1) |
| lastRemindedAt | DateTime? | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ |

### task_events

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | String | Primary key |
| taskId | String | FK ‚Üí tasks.id |
| type | Enum | CREATED / STATUS_CHANGED / ASSIGNED / REMINDED |
| oldStatus | TaskStatus? | –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∞—Ç—É—Å |
| newStatus | TaskStatus? | –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å |
| userId | String? | FK ‚Üí users.id |
| metadata | Json? | –î–æ–ø. –¥–∞–Ω–Ω—ã–µ |
| createdAt | DateTime | –í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è |

---

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

```bash
docker exec -it kontrol-postgres psql -U kontrol -d kontrol
# \dt ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
# SELECT * FROM tasks; ‚Äî –≤—Å–µ –∑–∞–¥–∞—á–∏
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å Redis

```bash
docker exec -it kontrol-redis redis-cli
# KEYS * ‚Äî –≤—Å–µ –∫–ª—é—á–∏
# LLEN bull:messages:waiting ‚Äî –∫–æ–ª-–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞

```bash
docker-compose logs -f app | grep Telegram
```

### –¢–µ—Å—Ç–æ–≤—ã–π payload –¥–ª—è Telegram

```bash
curl -X POST http://localhost:3000/telegram/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "update_id": 123,
    "message": {
      "message_id": 456,
      "from": {"id": 789, "username": "test_user", "first_name": "Test"},
      "chat": {"id": -1001234567890, "type": "group", "title": "Test Group"},
      "date": 1704110400,
      "text": "–ù–∞–¥–æ —Å—Ä–æ—á–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å —Ç–∏–ø–æ–Ω –Ω–∞ –¥–≤–µ—Ä–∏"
    }
  }'
```

---

## Production —á–µ–∫–ª–∏—Å—Ç

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω –∏ SSL (Let's Encrypt)
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ PostgreSQL –≤ docker-compose.yml
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã –ë–î (pg_dump)
- [ ] –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã (Winston)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (UptimeRobot, Sentry)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (systemd –∏–ª–∏ PM2)
- [ ] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ /admin (IP whitelist –∏–ª–∏ Basic Auth)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –¥–ª—è webhooks

---

## FAQ

**Q: –ë–æ—Ç –Ω–µ –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø–µ**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `/setprivacy` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ `Disable` —á–µ—Ä–µ–∑ @BotFather

**Q: –ó–∞–¥–∞—á–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å `source + sourceMessageId` –≤ –ë–î. –í–æ–∑–º–æ–∂–Ω–æ, webhook –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã.

**Q: LLM –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∑–∞–¥–∞—á–∏**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `LLM_API_KEY` –∏ –ª–æ–≥–∏ (`docker-compose logs -f app | grep LLM`)

**Q: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron (`CronExpression.EVERY_5_MINUTES`) –∏ `REMIND_NEW_MINUTES` –≤ .env

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å?**
A: –û–±–Ω–æ–≤–∏—Ç–µ enum –≤ `prisma/schema.prisma`, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é, –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –≤ `telegram.service.ts`

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

UNLICENSED (—á–∞—Å—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç)

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–í–æ–ø—Ä–æ—Å—ã/–ë–∞–≥–∏ ‚Üí —Å–æ–∑–¥–∞–π—Ç–µ issue –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!** üõ†Ô∏è
